<!DOCTYPE html>
<html lang="en">

<head>
  <link rel="stylesheet" href="styles/itemStyles.css">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MLOGE Exclusive shop</title>
</head>

<body>
  <div class="wrapper">
    <header>
      <div class="header-left">
        <button class="openBtn" id="openBtn"><img src="sources/menu.svg" alt=""></button>
        <div id="sidebar" class="sidebar">
          <a href="javascript:void(0)" id="closeBtn">&times;</a>
          <a href="#">Худи</a>
          <a href="#">Футболки</a>
          <a href="#">Брюки</a>
          <a href="#">Шорты</a>
          <a href="#">Кроссовки</a>
        </div>
        <a class="logo" href="mainPage.html"><img src="sources/logo.jpg" alt=""></a>
        <p>Novosibirsk</p>
      </div>
      <div class="header-right">
        <div class="search-box">
          <img class="search-icon" src="sources/search.svg" alt="">
          <input type="search" placeholder="Search" aria-label="Search">
        </div>
        <nav class="header-links">
          <a href="auth.html"><img src="sources/profile.svg" alt=""></a>
          <div class="order-container">
            <span id="counter" class="counter">0</span>
            <a href="favorite.html"><img src="sources/favorite.svg" alt=""></a>
          </div>
          <div class="order-container">
            <span id="counter" class="counter">0</span>
            <a href="order.html"><img src="sources/shopping-bag.svg" alt=""></a>
          </div>
        </nav>
      </div>
    </header>

    <main>
      <div class="container">
        <div class="left">
          <div class="product-gallery">
            <div class="main-photo" id="main-photo">
              <img id="photo" src="" alt="">
            </div>
            <div id="thumbnails" class="thumbnails">
            </div>
          </div>
        </div>
        <div class="right">
          <div id="product-title" class="product-title"></div>
          <p id="product-price" class="product-price">
          </p>
          <div id="sizes" class="sizes">
          </div>
          <div class="actions">
            <button class="add-to-cart-button">В корзину</button>
            <img class="likeButton" src="sources/favorite.svg" alt="">
          </div>
          <div class="section-title">Characters</div>
          <div id="product-params" class="product-params">
            <b>Type:</b> <br>
            <b>Color:</b> <br>
          </div>
          <div class="section-title">Description</div>
          <div id="product-description" class="product-description">
          </div>
        </div>
      </div>
    </main>

    <footer>
      <nav>
        <a href="#about">About us</a>
        <a href="#help">Help</a>
        <a href="#contacts">Contacts</a>
      </nav>
      <nav>
        <a href="#brand">Brand</a>
        <a href="#news">News</a>
        <a href="#job">Job</a>
        <a href="#mloge_club">MLOGE Club</a>
      </nav>
      <p>2024 MLOGE. Все права защищены.</p>
    </footer>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const productId = params.get('id');

    fetch(`http://localhost:5120/api/Products/${productId}`)
      .then(response => response.json())
      .then(data => initProductPage(data))
      .catch(error => console.error('Ошибка загрузки данных:', error));


    function initProductPage(data) {
      const mainPhoto = document.getElementById('main-photo');
      mainPhoto.innerHTML = `<img src="http://localhost:5120${data.imagesPath[0]}" alt="${data.name}">`;

      const thumbnails = document.getElementById('thumbnails');
      thumbnails.innerHTML = '';

      data.imagesPath.forEach((imgSrc, index) => {
        const img = document.createElement('img');
        img.src = `http://localhost:5120${imgSrc}`;
        img.alt = `thumb${index + 1}`;

        if (index === 0) img.classList.add('active');

        img.addEventListener('click', () => {
          thumbnails.querySelectorAll('img').forEach(i => i.classList.remove('active'));
          img.classList.add('active');
          mainPhoto.querySelector('img').src = imgSrc;
        });

        thumbnails.appendChild(img);
      });

      document.getElementById('product-title').textContent = data.name;

      const priceElem = document.getElementById('product-price');
      if (data.discountPrice && data.discountPrice < data.price) {
        priceElem.innerHTML = `${data.price}$ <del class="product-discount">${data.discountPrice}$</del>`;
      }
      else {
        priceElem.textContent = `${data.price}$`;
      }


      const sizesContainer = document.getElementById('sizes');
      sizesContainer.innerHTML = '';

      data.sizesLabel.forEach((size, index) => {
        const btn = document.createElement('button');
        btn.className = 'size-btn';
        if (index === 0) btn.classList.add('selected');
        btn.textContent = size;
        sizesContainer.appendChild(btn);
      });

      const paramsElem = document.getElementById('product-params');
      paramsElem.innerHTML = `
      <b>Type:</b> ${data.categoryName}<br>
      <b>Color:</b> ${data.color}<br>
      <b>Артикул:</b> ${data.id}`;

      document.getElementById('product-description').textContent = data.description;


      const thumbnailsImages = document.querySelectorAll('.thumbnails img');
      const mainImage = document.querySelector('#main-photo img');
      thumbnailsImages.forEach(thumb => {
        thumb.addEventListener('click', function () {
          thumbnailsImages.forEach(t => t.classList.remove('active'));
          this.classList.add('active');
          mainImage.src = this.src;
        });
      });

      const sizeBtns = document.querySelectorAll('.size-btn');
      sizeBtns.forEach(btn => {
        btn.addEventListener('click', function () {
          sizeBtns.forEach(b => b.classList.remove('selected'));
          this.classList.add('selected');
        });
      });
    }
  </script>
</body>

</html>